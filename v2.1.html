<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>WaveAtlas ‚Äì World Radio Map</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- SEO -->
<meta name="description" content="Explore live radio stations worldwide on an interactive map.">
<meta name="theme-color" content="#020617">

<!-- PWA -->
<link rel="manifest" href="manifest.json">

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

<!-- Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css">

<style>
:root{
  --bg:#0b1220;
  --panel:#020617;
  --accent:#00c6ff;
  --accent2:#38bdf8;
  --text:#e5f2ff;
  --muted:#94a3b8;
}
*{box-sizing:border-box}

body{
  margin:0;
  font-family:Inter,system-ui,sans-serif;
  background:var(--bg);
  color:var(--text);
  height:100vh;
  display:flex;
  overflow:hidden;
}

/* BUTTON */
.btn{
  padding:12px 18px;
  border-radius:16px;
  border:none;
  cursor:pointer;
  background:linear-gradient(135deg,var(--accent),var(--accent2));
  color:#001;
  font-weight:700;
  transition:.25s;
  backdrop-filter:blur(10px);
}
.btn:hover{transform:translateY(-2px);box-shadow:0 10px 30px rgba(0,198,255,.35)}
.btn:active{transform:scale(.96)}

/* SIDEBAR */
aside{
  width:220px;
  background:var(--panel);
  padding:16px;
}
aside h2{color:var(--accent)}
aside a{
  display:block;
  padding:12px;
  margin-bottom:6px;
  border-radius:14px;
  cursor:pointer;
}
aside a:hover{background:#1e293b}

/* MAIN */
main{
  flex:1;
  display:flex;
  flex-direction:column;
}
header{
  padding:14px 18px;
  background:#0f172a;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

/* SECTIONS */
section{
  flex:1;
  padding:18px;
  overflow:auto;
  animation:fade .4s ease;
}
.hidden{display:none}
@keyframes fade{
  from{opacity:0;transform:translateY(10px)}
  to{opacity:1}
}

/* CARDS */
.card{
  max-width:520px;
  margin:auto;
  background:rgba(255,255,255,.05);
  padding:24px;
  border-radius:22px;
  box-shadow:0 20px 60px rgba(0,0,0,.4);
}
.card h3{color:var(--accent)}

/* SETTINGS */
.setting{
  margin-top:14px;
  padding:14px;
  background:#020617;
  border-radius:16px;
}

/* MAP & STATIONS */
#map{
  width:100%;
  height:45vh;
  border-radius:18px;
}
#search{
  width:100%;
  padding:12px;
  border-radius:14px;
  border:1px solid #334155;
  background:#020617;
  color:white;
  margin-bottom:10px;
}
.station{
  padding:12px;
  border-radius:14px;
  background:rgba(255,255,255,.05);
  margin-bottom:6px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  cursor:pointer;
}
.station:hover{background:rgba(255,255,255,.15)}

/* LOADER */
.loader{
  width:40px;
  height:40px;
  border:4px solid #1e293b;
  border-top:4px solid var(--accent);
  border-radius:50%;
  animation:spin 1s linear infinite;
  margin:30px auto;
}
@keyframes spin{to{transform:rotate(360deg)}}

/* PLAYER */
#playerBar{
  position:fixed;
  bottom:14px;
  left:50%;
  transform:translateX(-50%);
  background:#020617;
  padding:12px 18px;
  border-radius:26px;
  display:none;
  gap:12px;
  align-items:center;
  box-shadow:0 20px 40px rgba(0,0,0,.6);
}

/* MOBILE */
@media(max-width:768px){
  aside{display:none}
  #map{height:35vh}
}
</style>
</head>

<body>

<aside>
  <h2>WaveAtlas</h2>
  <a onclick="nav('home')">üè† Home</a>
  <a onclick="nav('radios')">üìª Radios</a>
  <a onclick="nav('favorites')">‚≠ê Favorites</a>
  <a onclick="nav('help')">‚ùì Help</a>
</aside>

<main>
<header>
  <span id="welcome"></span>
  <button class="btn" onclick="logout()">Logout</button>
</header>

<!-- HOME -->
<section id="home">
  <div class="card">
    <h3>üëã Welcome to WaveAtlas</h3>
    <p style="color:var(--muted)">Explore world radios interactively üåç</p>

    <div class="setting">
      <strong>üë§ Profile</strong><br>
      <span id="username"></span>
    </div>

    <div class="setting">
      <strong>‚ö° Quick actions</strong><br><br>
      <button class="btn" onclick="nav('radios')">Start Listening</button>
      <button class="btn" style="margin-left:8px" onclick="nav('favorites')">Favorites</button>
    </div>

    <div class="setting">
      <strong>üîê Login</strong><br><br>
      <button class="btn" onclick="fakeLogin('Google')">Google</button>
      <button class="btn" onclick="fakeLogin('Facebook')" style="margin-left:8px">Facebook</button>
    </div>
  </div>
</section>

<!-- RADIOS -->
<section id="radios" class="hidden">
  <input id="search" placeholder="Search station..." oninput="filterStations()">
  <div id="map"></div>
  <div id="stations"></div>
</section>

<!-- FAVORITES -->
<section id="favorites" class="hidden">
  <div class="card">
    <h3>‚≠ê Favorites</h3>
    <div id="favList"></div>
  </div>
</section>

<!-- HELP -->
<section id="help" class="hidden">
  <div class="card">
    <h3>‚ùì Help</h3>
    <p>üìç Click on the map to select a country</p>
    <p>üìª Choose a working radio station</p>
    <p>‚≠ê Save radios to favorites</p>
  </div>
</section>

</main>

<div id="playerBar">
  <button class="btn" onclick="togglePlay()">‚èØ</button>
  <span id="nowPlaying"></span>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
/* SESSION */
const name = localStorage.getItem("session") || "Explorer";
welcome.innerText = `Welcome back, ${name} üåç`;
username.innerText = name;

/* NAV */
function nav(id){
  document.querySelectorAll("section").forEach(s=>s.classList.add("hidden"));
  document.getElementById(id).classList.remove("hidden");
  if(id==="radios" && !window.mapInit){initMap();window.mapInit=true;}
}

/* LOGIN */
function fakeLogin(p){
  localStorage.setItem("session", p+" User");
  location.reload();
}
function logout(){
  localStorage.clear();
  location.reload();
}

/* AUDIO */
let player = new Audio();
player.crossOrigin="anonymous";
player.volume=0.8;
function togglePlay(){player.paused?player.play():player.pause()}

/* MAP */
let map, stationsData=[];
function initMap(){
  map=L.map("map").setView([20,0],2);
  L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:18}).addTo(map);
  map.on("click",async e=>{
    const c=await getCountry(e.latlng.lat,e.latlng.lng);
    if(c) loadRadios(c);
  });
}

async function getCountry(lat,lon){
  const r=await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`);
  const d=await r.json();
  return d?.address?.country_code?.toUpperCase();
}

async function loadRadios(country){
  stations.innerHTML=`<div class="loader"></div>`;
  const r=await fetch(`https://de1.api.radio-browser.info/json/stations/search?limit=20&countrycode=${country}`);
  stationsData=(await r.json()).filter(s=>s.url_resolved && s.url_resolved.startsWith("https"));
  renderStations(stationsData);
}

function renderStations(list){
  stations.innerHTML="";
  list.forEach(st=>{
    const d=document.createElement("div");
    d.className="station";
    d.innerHTML=`<span>${st.name}</span><button class="btn">‚ù§Ô∏è</button>`;
    d.onclick=()=>{
      player.src=st.url_resolved;
      player.play();
      nowPlaying.innerText=st.name;
      playerBar.style.display="flex";
    };
    d.querySelector("button").onclick=e=>{
      e.stopPropagation();
      addFav(st);
    };
    stations.appendChild(d);
  });
}

/* SEARCH */
function filterStations(){
  const q=search.value.toLowerCase();
  renderStations(stationsData.filter(s=>s.name.toLowerCase().includes(q)));
}

/* FAVORITES */
let favs=JSON.parse(localStorage.getItem("favs")||"[]");
function addFav(st){
  if(favs.find(f=>f.id===st.stationuuid))return;
  favs.push({id:st.stationuuid,name:st.name,url:st.url_resolved});
  localStorage.setItem("favs",JSON.stringify(favs));
  loadFavs();
}
function loadFavs(){
  favList.innerHTML="";
  favs.forEach(f=>{
    const d=document.createElement("div");
    d.className="station";
    d.innerText=f.name;
    d.onclick=()=>{
      player.src=f.url;
      player.play();
      nowPlaying.innerText=f.name;
      playerBar.style.display="flex";
    };
    favList.appendChild(d);
  });
}
loadFavs();

/* PWA */
if("serviceWorker"in navigator){
  navigator.serviceWorker.register("sw.js");
}
</script>

</body>
</html>
